<!--
This was the original plan for the project. Some things may have changed, but I didn't have time to continue with this, and this is great for now.
-->
# FFMPEG Command Generator with AI - Tauri Desktop App

## Project Overview
An application that allows users to:
1. Select media files through a modern desktop UI with drag and drop
2. Provide OpenAI API key on first launch (stored securely)
3. Describe their desired operation in natural language
4. Get an FFMPEG command generated by GPT-4
5. Review and approve the generated command
6. Execute the approved command locally using Tauri's native capabilities
7. Save the output with "_neta" suffix and optional numbering in the same directory as input

## Technical Stack
- Tauri for desktop application framework
- React + Vite for frontend
- Chakra UI for component library and styling
- OpenAI GPT-4 API for command generation
- react-dropzone for drag and drop functionality
- Tauri's native APIs for file system operations and command execution
- Tauri's secure storage for API key management

## Core Components

### 1. API Key Management Component
- First-launch detection
- API key input form
- Secure storage using Tauri's secure store
- Validation of API key
- Option to update key in settings

### 2. File Selection Component
- Drag and drop interface using react-dropzone
- Native file browser dialog using Tauri's dialog API
- Visual feedback during drag operations
- File type validation
- Multiple file selection support
- Preview of selected files
- Capture and store absolute file paths
- Path validation and normalization

### 3. User Input Component
- Chakra UI Input and FormControl components
- Text input field for describing desired operation
- Examples of possible operations using Alert components
- History of previous operations using List components (optional)
- Input validation and feedback

### 4. Command Generation Component
- Integration with OpenAI API
- Prompt engineering for accurate FFMPEG command generation
- Display generated command with Code component
- Command explanation using Alert components
- Command review and approval interface
- Loading states and error handling using Chakra UI components

### 5. Command Execution Component
- Execute FFMPEG command using Tauri's Command API
- Maintain original file directory context
- Smart output file naming:
  - Single output: inputname_neta.ext
  - Multiple outputs: inputname_neta_1.ext, inputname_neta_2.ext, etc.
- Progress indicator using Chakra UI Progress component
- Error handling with Toast notifications
- Status updates using Badge components

## Implementation Steps

1. **Project Setup**
   - Create new Tauri + React project:
     ```bash
     npm create tauri-app
     ```
   - Install dependencies:
     ```bash
     npm install @chakra-ui/react @emotion/react @emotion/styled framer-motion react-dropzone openai
     ```
   - Set up ChakraProvider
   - Configure Tauri permissions and capabilities
   - Set up secure storage for API key

2. **API Key Management**
   - Implement first-launch detection
   - Create API key input interface
   - Set up secure storage with Tauri
   - Add key validation system
   - Create key update mechanism

3. **UI Development**
   - Create main layout using Chakra UI Grid/Flex
   - Implement file selection interface with react-dropzone and Tauri dialogs
   - Build operation description input with Chakra components
   - Design command display with syntax highlighting
   - Add command approval interface
   - Implement responsive design

4. **OpenAI Integration**
   - Set up OpenAI API connection
   - Create prompt template for FFMPEG command generation
   - Implement error handling with Toast notifications
   - Add retry logic with loading states

5. **FFMPEG Integration**
   - Implement FFMPEG command execution using Tauri's Command API
   - Handle file path management with Tauri's Path API
   - Implement output file naming convention
   - Add progress tracking with Progress component

6. **Testing & Refinement**
   - Test with various file types
   - Test different operation types
   - Optimize prompt engineering
   - Add error recovery mechanisms

## Security Considerations
- File path handling using Tauri's security model
- API key storage using Tauri's SecureStore
- Command injection prevention
- Input validation with proper error messages
- Proper configuration of Tauri's allowlist
- Secure handling of absolute file paths

## Example User Flow
1. First launch: User provides OpenAI API key
2. User drops a video file into the drag and drop zone or uses native file picker
3. Application captures absolute path: e.g., "/home/user/videos/input.mp4"
4. Visual feedback shows successful file selection
5. User types: "I want to compress this video to 720p and reduce file size"
6. Loading state shows AI processing with GPT-4
7. AI generates: `ffmpeg -i "/home/user/videos/input.mp4" -vf scale=-1:720 -c:v libx264 -crf 23 -preset medium -c:a aac "/home/user/videos/input_neta.mp4"`
8. Command displayed in a Code block with approval button
9. User reviews and approves the command
10. Progress bar shows execution progress
11. Success toast shows when output is saved with proper naming

## File Naming Convention
1. **Single Output Operation**
   - Input: /path/to/file/input.mp4
   - Output: /path/to/file/input_neta.mp4

2. **Multiple Output Operation**
   - Input: /path/to/file/input.mp4
   - Outputs:
     - /path/to/file/input_neta_1.mp4
     - /path/to/file/input_neta_2.mp4
     - etc.

## Project Structure
```
src-tauri/
├── src/
│   ├── main.rs
│   ├── storage.rs
│   └── command.rs
src/
├── components/
│   ├── ApiKey/
│   │   ├── index.jsx
│   │   └── KeyInput.jsx
│   ├── FileSelector/
│   │   ├── index.jsx
│   │   ├── DropZone.jsx
│   │   └── FileList.jsx
│   ├── CommandInput/
│   │   ├── index.jsx
│   │   └── Examples.jsx
│   ├── CommandDisplay/
│   │   ├── index.jsx
│   │   ├── CodeBlock.jsx
│   │   └── ApprovalButton.jsx
│   └── ExecutionPanel/
│       ├── index.jsx
│       └── ProgressBar.jsx
├── services/
│   ├── openai/
│   │   ├── index.js
│   │   └── gpt4.js
│   └── ffmpeg/
│       ├── index.js
│       └── pathHandler.js
├── hooks/
│   ├── useFFmpeg/
│   ├── useDropzone/
│   └── useApiKey/
├── utils/
│   ├── pathHandling.js
│   ├── commandValidation.js
│   └── fileNaming.js
└── App.jsx
```

## Key Features
1. **Desktop Integration**
   - Native file system access
   - System-native dialogs
   - Local command execution
   - Cross-platform compatibility
   - Command approval workflow
   - Secure API key storage

2. **File Handling**
   - Drag and drop with react-dropzone
   - Native file picker integration
   - Absolute path preservation
   - Smart output file naming
   - Support for multiple file types
   - Visual feedback during operations
   - File validation with error messages
   - Progress tracking

3. **AI Integration**
   - GPT-4 powered command generation
   - API key management
   - Context-aware suggestions
   - Error prevention with validation
   - Command explanation with formatted display
   - Loading states and error handling

4. **User Experience**
   - Clean, modern desktop interface
   - Responsive design
   - Interactive feedback
   - Toast notifications for status updates
   - Progress indicators
   - Accessible components
   - Error messages in plain language
   - Command review and approval interface
   - First-launch API key setup 